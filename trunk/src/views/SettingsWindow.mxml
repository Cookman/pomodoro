<?xml version="1.0"?>
<!--
  Created by Cookman on 03.12.2014.
-->
<s:Window xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
          xmlns:mx="library://ns.adobe.com/flex/mx" resizable="false"
          width="260" height="150" showStatusBar="false" isPopUp="true" alwaysInFront="true"
          title="{resourceManager.getString('resources', 'SETTINGS')}"
          maximizable="false"
          minimizable="false" type="{NativeWindowType.UTILITY}"
          creationComplete="creationCompleteHandler(event)" close="closeHandler(event)">
    <fx:Script><![CDATA[
        import models.LocalStorage;
        import models.MindTimerModel;

        import mx.collections.ArrayCollection;
        import mx.events.ListEvent;

        import views.renderer.CustomListItemEditor;

        import vo.SettingsVO;

        private var settings:SettingsVO;
        private var model:MindTimerModel = MindTimerModel.getInstance();

        protected function creationCompleteHandler(event:Event):void {
            settings = model.settings;
            if (settings) {
                usePomLength.selected = settings.useFixedPomodoroLength;
                countPoms.selected = settings.showPomodoroStatistic;
                pomodoroLength.text = settings.pomodoroLength.toString();
                template1.text = settings.templates[0];
                template2.text = settings.templates[1];
                template3.text = settings.templates[2];
                template4.text = settings.templates[3];
                useRecommendsCheckBox.selected = settings.useRecommends;
                cycleRecommendsCheckBox.selected = settings.cycleRecommends;
                timeRecommendList.dataProvider = new ArrayCollection(settings.recommends);
                for each(var item:Object in languageBox.dataProvider) {
                    if (item.value == settings.language) {
                        languageBox.selectedItem = item;
                    }
                }
                resetCheckBox.selected=settings.resetDay;
                model.activateResetDay();
            }
        }

        protected function okHandler(event:Event):void {
            if (settings) {
                settings.useFixedPomodoroLength = usePomLength.selected;
                settings.pomodoroLength = parseInt(pomodoroLength.text);
                settings.showPomodoroStatistic = countPoms.selected;
                settings.templates[0] = template1.text;
                settings.templates[1] = template2.text;
                settings.templates[2] = template3.text;
                settings.templates[3] = template4.text;
                settings.useRecommends = useRecommendsCheckBox.selected;
                settings.cycleRecommends = cycleRecommendsCheckBox.selected;
                settings.recommends = timeRecommendList.dataProvider.toArray();
                settings.language = languageBox.selectedItem.value;
                settings.resetDay=resetCheckBox.selected;
                LocalStorage.saveSettings(settings);
                model.loadSettings();
                model.trayIt.setPomodoroStatistic(model.showPomodoroStatistic);
                model.trayIt.show();
                model.trayIt.settingsShown = false;
                this.close();
            }
        }

        protected function cancelHandler(event:Event):void {
            model.doLocalization(settings.language)
            model.trayIt.show();
            model.trayIt.settingsShown = false;
            model.trayIt.setPomodoroStatistic(model.showPomodoroStatistic);
            this.close();
        }

        protected function addTime(event:Event):void {
            timeRecommendList.dataProvider.addItem({value: addTimeInput.text})
            addTimeInput.text = "";
        }

        private function editEndHandler(event:ListEvent):void {
            event.preventDefault();
            event.stopImmediatePropagation();
            timeRecommendList.editedItemRenderer.data.value = CustomListItemEditor(event.currentTarget.itemEditorInstance).valueInput.text;
            timeRecommendList.destroyItemEditor();
            timeRecommendList.dataProvider.itemUpdated(timeRecommendList.editedItemRenderer);
        }

        private function languageChangeHandler(event:Event):void {
            model.doLocalization(languageBox.selectedItem.value)
        }

        private function closeHandler(event:Event):void
        {
            model.trayIt.settingsShown = false;
        }
        ]]></fx:Script>
    <s:VGroup width="100%" height="100%">
        <mx:TabNavigator width="100%" height="100%" creationPolicy="all">
            <mx:VBox width="100%" height="100%" label="{resourceManager.getString('resources', 'POMS')}" paddingLeft="10">
                <s:CheckBox id="countPoms" label="{resourceManager.getString('resources', 'COUNT_POMS')}"></s:CheckBox>
                <mx:HBox width="100%" verticalAlign="middle">
                    <s:CheckBox id="usePomLength" height="100%"
                                label="{resourceManager.getString('resources', 'USE_POM_LENGTH')}"></s:CheckBox>
                    <s:TextInput id="pomodoroLength" height="100%" enabled="{usePomLength.selected}" text="25" width="25" maxChars="2"
                                 restrict="0-9"/>
                </mx:HBox>
                <s:CheckBox id="resetCheckBox" label="{resourceManager.getString('resources', 'RESET_DAY')}" />
            </mx:VBox>
            <mx:VBox width="100%" height="100%" paddingLeft="10" label="{resourceManager.getString('resources', 'TIME_TEMPLATES')}">
                <s:VGroup>
                    <s:HGroup verticalAlign="middle">
                        <s:Label text="time 1"/>
                        <s:TextInput id="template1" width="25" restrict="0-9"/>
                        <s:Label text="time 2"/>
                        <s:TextInput id="template2" width="25" restrict="0-9"/>
                    </s:HGroup>
                    <s:HGroup verticalAlign="middle">
                        <s:Label text="time 3"/>
                        <s:TextInput id="template3" width="25" restrict="0-9"/>
                        <s:Label text="time 4"/>
                        <s:TextInput id="template4" width="25" restrict="0-9"/>
                    </s:HGroup>
                </s:VGroup>
            </mx:VBox>

            <mx:HBox width="100%" height="100" paddingLeft="10" label="{resourceManager.getString('resources', 'RECOMMEND')}"
                     verticalScrollPolicy="off">

                <mx:VBox>
                    <s:CheckBox id="useRecommendsCheckBox"
                                label="{resourceManager.getString('resources', 'USE_RECOMMENDS')}"/>
                    <s:CheckBox id="cycleRecommendsCheckBox"
                                label="{resourceManager.getString('resources', 'CYCLE_RECOMMENDS')}"/>
                    <mx:HBox>
                        <s:TextInput id="addTimeInput" width="30" restrict="0-9"/>
                        <s:Button id="addButton" label="{resourceManager.getString('resources', 'ADD')}"
                                  click="addTime(event)" enabled="{addTimeInput.text!=''}"/>
                    </mx:HBox>
                </mx:VBox>
                <mx:List id="timeRecommendList" width="100%" height="100%"
                         itemEditor="views.renderer.CustomListItemEditor"
                         itemRenderer="views.renderer.CustomListItemRenderer"
                         editable="true"
                         rowCount="3"
                         variableRowHeight="false"
                         itemEditEnd="editEndHandler(event)">
                </mx:List>
            </mx:HBox>

            <mx:HBox width="100%" height="100" paddingLeft="10" label="{resourceManager.getString('resources', 'OTHER')}"
                     verticalScrollPolicy="off">
                <mx:ComboBox id="languageBox" labelField="label"
                             dataProvider="{[{label:'English',value:MindTimerModel.EN_US},{label:'Русский',value:MindTimerModel.RU_RU}]}"
                             change="languageChangeHandler(event)"/>
            </mx:HBox>
        </mx:TabNavigator>
        <s:HGroup width="100%" verticalAlign="middle" horizontalAlign="center">
            <mx:Button click="okHandler(event)" label="{resourceManager.getString('resources', 'OK')}"/>
            <mx:Button click="cancelHandler(event)" label="{resourceManager.getString('resources', 'CANCEL')}"/>
        </s:HGroup>
    </s:VGroup>
</s:Window>